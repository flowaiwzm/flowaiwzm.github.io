#### 条件对抗网络(CGAN)

**核心：将额外的条件信息引入到原始GAN的架构中，使得生成器和判别器在训练过程中同时考虑条件变量**

- 在理想情况下，GAN的训练过程可视为生成器G与判别器D之间的一种零和博弈，当两者达到纳什均衡时，生成器能够生成与真实数据分布无法区分的样本。
- CGAN的目标是使生成器G在给定条件变量c的情况下，生成的数据分布逼近真实数据在相同条件c下的分布，即$P(G(z|c))\approx P(X|c)$，其中z为噪声输入，X为真实数据。

**算法原理**

CGAN在标准GAN的基础上引入条件变量c,扩展了生成器与判别器的输入空间

- **生成器G**：接收到噪声z与条件变量c作为输入，生成与条件c相关的样本G(z|c)。条件c可以是类别标签、文本描述、图像属性等多种形式。
- **判别器D**：不仅判断输入样本是否真实，还需预测其对应条件变量。其目标函数包含了两部分：一是**识别真实样本与伪造样本的能力**，二是**对条件变量c的准确预测**。
- **生成器损失L_G**：鼓励判别器D对生成样本G(z|c)及相应条件c的判断为“真实”，即最大化log(D(G(z|c), c))
- **判别器损失L_D**：鼓励D正确区分真实样本（X, c）与生成样本（G(z|c), c），即最小化E_{(X,c)P(X,c)}[log(D(X,c))] - E_{zP(z)}[log(1-D(G(z|c), c)))]

**算法实现**

- **数据预处理**：整理包含条件变量的数据集，如对图像进行归一化，并将类别标签编码为one-hot向量
- **网络结构设计**：构建具有条件输入的生成器和判别器网络。对于条件变量c可以将其直接拼接到噪声z或特征映射上，也可以通过额外的嵌入层处理
- **训练流程**：
  - a. 随机抽取噪声z与条件变量c。 
  - b. 生成器生成样本G(z|c)。 
  - c. 判别器分别对真实样本（X, c）与生成样本（G(z|c), c）进行判断，并计算损失。 
  - d. 更新判别器参数以最小化D的损失。 
  - e. 固定判别器参数，更新生成器参数以最小化G的损失。 
  - f. 循环以上步骤直至收敛

---

1、图像合成；2、图像翻译；3、3D模型生成

对比其他算法的优势：与标准GAN的增加了**条件控制**，增强了生成任务的针对性和实用性，而标准GAN仅能生成未标记数据的随机样本；与VAE变分自编码器，VAE也是生成型网络，但其**生成过程是确定性的**，而且通常生成质量不如CGAN。而CGAN通过对抗训练得到更高质量样本但是会面临训练不稳的情况。

图像翻译----生成器*G*采用基于*U-net*网络架构而判别器采用*PatchGAN*分类器

PatchGAN相比于CGAN的是输出NxN的矩阵x，每个元素$x[i][j]$表示一个patch,对应于图像的一个感受野，最后结果求平均值--

- 这种机制主要是将局部特征和整体图像特征相融合，这种方式通过对每个patch进行差别的判断，实现局部图像特征的提取和表征，有利于实现更高分辨率的图像生产；同时对最后的分类特征图进行平均后，也能实现真实图像和虚假图像的相比；
- 单标量输出的更为精确的整体差异表示，相当于对整体进行加权求和平均，对于某些特征差异大的局部图像特征， 能够实现比传统的 D网络 更为合理的 损失表示。